<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.5.2/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
</head>
<body>
Hands and Brain Chess
<table class="table table-striped table-striped-columns">
    <tr th:each="row, i: ${Feld}">
        <td th:each="Figuren, j:${row}">
            <span th:switch="${Figuren}">
            <a class="move" th:href="@{/move(idrow=${i.index},idcolumn=${j.index})}" >
                <span th:case="null">
                    null
                </span>

                <span th:case="*">
                    <span th:text="${Figuren.getType().toString()+ Figuren.getTeam()}">
                        test
                    </span>

                </span>
            </a>
            </span>

        </td>
    </tr>
</table>
<form th:action="@{/}" method="post">
    <button type="submit">Spiel aufsezten</button>
</form>
<script>
    const clientId = localStorage.getItem('clientId') || Math.random().toString(36).substring(2);
    localStorage.setItem('clientId',clientId);

    window.addEventListener('load', (e) => {
        const socket = new SockJS('/stomp-endpoint')
        const stompClient = Stomp.over(socket)
        stompClient.connect({}, (frame) => {
            stompClient.subscribe('/topic/greetings', (senderId) => {
                if(senderId.body != clientId){
                    console.log(senderId.body)
                    location.reload();
                }
            });
            Array.from(document.getElementsByClassName("move")).forEach((element)=> element.addEventListener('click',(e) =>{
                console.log('move')
                    stompClient.send('/app/hello', {},clientId)
            }))
        });
  /* window.addEventListener('load', (e) => {
        const socket = new SockJS('/stomp-endpoint')
        const stompClient = Stomp.over(socket)
        stompClient.connect({}, (frame) => {
            stompClient.subscribe('/topic/greetings', (greeting) => {
                console.log('UPDATE')
                location.reload();
            });
            Array.from(document.getElementsByClassName("move")).forEach((element)=> element.addEventListener('click',(e) =>{
                console.log('move')
                stompClient.send('/app/hello', {}, JSON.stringify({name: 'Tammie'}))
            }))
        });*/

    })
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>